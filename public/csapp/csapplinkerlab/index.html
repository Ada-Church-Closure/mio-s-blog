<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="light"
  data-auto-appearance="false"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>CSAPP:LinkerLab &middot; Mio&#39;s Tea Time</title>
  <meta name="title" content="CSAPP:LinkerLab &middot; Mio&#39;s Tea Time" />
  
  <meta name="description" content="Mio&#39;s Tea Time" />
  
  
  
  <link rel="canonical" href="https://Ada-Church-Closure.github.io/csapp/csapplinkerlab/" />
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.721003f09449a0912bb62104688e960d177f51b3c09f0e387a1d0e5fc2e5b6c8158a4ea485544ea400f5efb68debb909febd470b6dea83625d5103f116f771be.css"
    integrity="sha512-chAD8JRJoJErtiEEaI6WDRd/UbPAnw44eh0OX8LltsgVik6khVROpAD177aN67kJ/r1HC23qg2JdUQPxFvdxvg==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.65b5de43825ad54a420102c9ddccece1f1015665fe76e5b399ba259e1de29f6c83ac1b3cf77beed3d29e26604dfebf561a8e1db523cb6add0d6acccc9e8f1307.js"
    integrity="sha512-ZbXeQ4Ja1UpCAQLJ3czs4fEBVmX&#43;duWzmbolnh3in2yDrBs893vu09KeJmBN/r9WGo4dtSPLat0NaszMno8TBw==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  <meta name="google-site-verification" content="wgfczhyzH3lSC7Nvoty3A1-Ekb1NZsLDiZjGnjb-LbU" />
  
  
  
  
  
  
  <meta property="og:url" content="https://Ada-Church-Closure.github.io/csapp/csapplinkerlab/">
  <meta property="og:site_name" content="Mio&#39;s Tea Time">
  <meta property="og:title" content="CSAPP:LinkerLab">
  <meta property="og:description" content="CSAPP:LinkerLab # CSAPP上关于链接的知识我也会放在这里……
本文图片大多来源于英文原版CSAPP。
链接机制详解 # ​	有多详细？这很难定义吧，是否详细应当取决于读者本来的理解,linking本身就是看起来好像就是打包一下很简单的东西，但是涉及到的知识比较复杂，应用也相当广泛。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="csapp">
    <meta property="article:published_time" content="2025-04-19T16:27:09+08:00">
    <meta property="article:modified_time" content="2025-04-19T16:27:09+08:00">
    <meta property="og:image" content="https://Ada-Church-Closure.github.io/csapp/csapplinkerlab/featured.jpg">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://Ada-Church-Closure.github.io/csapp/csapplinkerlab/featured.jpg">
  <meta name="twitter:title" content="CSAPP:LinkerLab">
  <meta name="twitter:description" content="CSAPP:LinkerLab # CSAPP上关于链接的知识我也会放在这里……
本文图片大多来源于英文原版CSAPP。
链接机制详解 # ​	有多详细？这很难定义吧，是否详细应当取决于读者本来的理解,linking本身就是看起来好像就是打包一下很简单的东西，但是涉及到的知识比较复杂，应用也相当广泛。">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "",
    "name": "CSAPP:LinkerLab",
    "headline": "CSAPP:LinkerLab",
    
    "abstract": "\u003ch1 class=\u0022relative group\u0022\u003eCSAPP:LinkerLab \n    \u003cdiv id=\u0022csapplinkerlab\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\u0022\u003e\n        \u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022\n            style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#csapplinkerlab\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e        \n    \n\u003c\/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCSAPP上关于链接的知识我也会放在这里\u0026hellip;\u0026hellip;\u003c\/p\u003e\n\u003cp\u003e本文图片大多来源于英文原版CSAPP。\u003c\/p\u003e\u003c\/blockquote\u003e\n\n\n\u003ch2 class=\u0022relative group\u0022\u003e链接机制详解 \n    \u003cdiv id=\u0022%E9%93%BE%E6%8E%A5%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\u0022\u003e\n        \u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022\n            style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#%E9%93%BE%E6%8E%A5%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e        \n    \n\u003c\/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e​\t有多详细？这很难定义吧，是否详细应当取决于读者本来的理解,linking本身就是看起来好像就是打包一下很简单的东西，但是涉及到的知识比较复杂，应用也相当广泛。\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "https:\/\/Ada-Church-Closure.github.io\/csapp\/csapplinkerlab\/",
    "author" : {
      "@type": "Person",
      "name": "mio"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-04-19T16:27:09\u002b08:00",
    "datePublished": "2025-04-19T16:27:09\u002b08:00",
    
    "dateModified": "2025-04-19T16:27:09\u002b08:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1520"
  }]
  </script>


  
  
  <meta name="author" content="mio" />
  
  
  
  <link href="nunotabashinobu066@gmail.com" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  



  
  
  <meta name="theme-color"/>
  
  
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script>

    const firebaseConfig = {
      apiKey: "AIzaSyCswaKAVVuCYg9UesFR0aQOkre1tVIv5co",
      authDomain: "AIzaSyCswaKAVVuCYg9UesFR0aQOkre1tVIv5co",
      projectId: "mio-s-app",
      storageBucket: "mio-s-app.firebasestorage.app",
      messagingSenderId: "491061548873",
      appId: "1:491061548873:web:9de625ab436bdfd1e3ec98",
      measurementId: "G-EH5EXVC7V4"
    };

    var app = firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();
    var auth = firebase.auth();

  </script>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">Mio&rsquo;s Tea Time</span>

            
            <img src="/img/logo.png" width="342" height="318"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="Mio&#39;s Tea Time" />
            

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Mio&rsquo;s Tea Time</a>
            

        </nav>
        <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">

            
            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      Class
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/notes/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            学校课程笔记
          </p>
        </a>
        
        <a href="/csapp/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            CS:APP
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
            
  <a href="/tech/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Tech">
        Tech
    </p>
</a>



            
            
  <a href="/thinking/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Thinking">
        Thinking
    </p>
</a>



            
            
  <a href="/life/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Life">
        せいかつ
    </p>
</a>



            
            
  <a href="/author/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Author
    </p>
</a>



            
            
  <a href="https://github.com/Ada-Church-Closure"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <span >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


    </span>
    
    <p class="text-base font-medium" title="">
        
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class=" flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                     
  <li class="mt-1">
    <a href="" class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Class
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/notes/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            学校课程笔记
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/csapp/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            CS:APP
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                    
  <li class="mt-1">
    <a href="/tech/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Tech">
            Tech
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/thinking/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Thinking">
            Thinking
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/life/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Life">
            せいかつ
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/author/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Author
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="https://github.com/Ada-Church-Closure"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <div >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


        </div>
        
        <p class="text-bg font-bg" title="">
            
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>





  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      CSAPP:LinkerLab
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  



  



  



  







<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2025-04-19T16:27:09&#43;08:00">19 April 2025</time><span class="px-2 text-primary-500">&middot;</span><span>1520 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">8 mins</span><span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span id="views_csapp/CSAPP:LinkerLab/index.md" class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400" title="views">loading</span>
  <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
<path fill="currentColor" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg>
  </span>

</span>
</span><span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span id="likes_csapp/CSAPP:LinkerLab/index.md"
    class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400"
    title="likes">loading</span>
  <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
  </span>

</span>
</span><span class="px-2 text-primary-500">&middot;</span><span>
    <button id="button_likes"
        class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
        onclick="process_article()">
        <span id="button_likes_heart" style="display:none" class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
  </span>

 </span>
        <span id="button_likes_emtpty_heart" class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M244 84L255.1 96L267.1 84.02C300.6 51.37 347 36.51 392.6 44.1C461.5 55.58 512 115.2 512 185.1V190.9C512 232.4 494.8 272.1 464.4 300.4L283.7 469.1C276.2 476.1 266.3 480 256 480C245.7 480 235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1 0 232.4 0 190.9V185.1C0 115.2 50.52 55.58 119.4 44.1C164.1 36.51 211.4 51.37 244 84C243.1 84 244 84.01 244 84L244 84zM255.1 163.9L210.1 117.1C188.4 96.28 157.6 86.4 127.3 91.44C81.55 99.07 48 138.7 48 185.1V190.9C48 219.1 59.71 246.1 80.34 265.3L256 429.3L431.7 265.3C452.3 246.1 464 219.1 464 190.9V185.1C464 138.7 430.4 99.07 384.7 91.44C354.4 86.4 323.6 96.28 301.9 117.1L255.1 163.9z"/></svg>
  </span>

</span>
        <span id="button_likes_text">&nbsp;Like</span>
    </button>
</span>
  

  
  
</div>








    </div>

    
    
    
    
    

    

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#链接机制详解">链接机制详解</a>
      <ul>
        <li><a href="#编译器驱动程序">编译器驱动程序</a></li>
        <li><a href="#静态链接">静态链接</a></li>
        <li><a href="#目标文件">目标文件</a></li>
        <li><a href="#可重定位目标文件">可重定位目标文件</a></li>
        <li><a href="#符号和符号表">符号和符号表</a></li>
        <li><a href="#符号解析">符号解析</a>
          <ul>
            <li><a href="#多重定义的全局符号">多重定义的全局符号？</a></li>
            <li><a href="#与静态库的链接">与静态库的链接？</a></li>
            <li><a href="#如何使用静态库解析引用">如何使用静态库解析引用？</a></li>
          </ul>
        </li>
        <li><a href="#重定位">重定位</a>
          <ul>
            <li><a href="#重定位条目">重定位条目</a></li>
            <li><a href="#重定位符号引用">重定位符号引用</a></li>
            <li><a href="#重定位pc相对引用">重定位PC相对引用</a></li>
            <li><a href="#重定位绝对引用">重定位绝对引用</a></li>
          </ul>
        </li>
        <li><a href="#可执行目标文件">可执行目标文件</a></li>
        <li><a href="#加载可执行目标文件">加载可执行目标文件</a></li>
      </ul>
    </li>
    <li><a href="#实验">实验：</a>
      <ul>
        <li>
          <ul>
            <li><a href="#objectfile">ObjectFile</a></li>
            <li><a href="#section">Section</a></li>
            <li><a href="#symbol">Symbol</a></li>
            <li><a href="#relocentry">RelocEntry</a></li>
            <li><a href="#allobject">allObject</a></li>
            <li><a href="#mergedobject">mergedObject</a></li>
            <li><a href="#重定位的逻辑">重定位的逻辑：</a></li>
            <li><a href="#符号解析的逻辑">符号解析的逻辑：</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#链接机制详解">链接机制详解</a>
      <ul>
        <li><a href="#编译器驱动程序">编译器驱动程序</a></li>
        <li><a href="#静态链接">静态链接</a></li>
        <li><a href="#目标文件">目标文件</a></li>
        <li><a href="#可重定位目标文件">可重定位目标文件</a></li>
        <li><a href="#符号和符号表">符号和符号表</a></li>
        <li><a href="#符号解析">符号解析</a>
          <ul>
            <li><a href="#多重定义的全局符号">多重定义的全局符号？</a></li>
            <li><a href="#与静态库的链接">与静态库的链接？</a></li>
            <li><a href="#如何使用静态库解析引用">如何使用静态库解析引用？</a></li>
          </ul>
        </li>
        <li><a href="#重定位">重定位</a>
          <ul>
            <li><a href="#重定位条目">重定位条目</a></li>
            <li><a href="#重定位符号引用">重定位符号引用</a></li>
            <li><a href="#重定位pc相对引用">重定位PC相对引用</a></li>
            <li><a href="#重定位绝对引用">重定位绝对引用</a></li>
          </ul>
        </li>
        <li><a href="#可执行目标文件">可执行目标文件</a></li>
        <li><a href="#加载可执行目标文件">加载可执行目标文件</a></li>
      </ul>
    </li>
    <li><a href="#实验">实验：</a>
      <ul>
        <li>
          <ul>
            <li><a href="#objectfile">ObjectFile</a></li>
            <li><a href="#section">Section</a></li>
            <li><a href="#symbol">Symbol</a></li>
            <li><a href="#relocentry">RelocEntry</a></li>
            <li><a href="#allobject">allObject</a></li>
            <li><a href="#mergedobject">mergedObject</a></li>
            <li><a href="#重定位的逻辑">重定位的逻辑：</a></li>
            <li><a href="#符号解析的逻辑">符号解析的逻辑：</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h1 class="relative group">CSAPP:LinkerLab 
    <div id="csapplinkerlab" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#csapplinkerlab" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<blockquote>
<p>CSAPP上关于链接的知识我也会放在这里&hellip;&hellip;</p>
<p>本文图片大多来源于英文原版CSAPP。</p></blockquote>


<h2 class="relative group">链接机制详解 
    <div id="%E9%93%BE%E6%8E%A5%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%93%BE%E6%8E%A5%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<blockquote>
<p>​	有多详细？这很难定义吧，是否详细应当取决于读者本来的理解,linking本身就是看起来好像就是打包一下很简单的东西，但是涉及到的知识比较复杂，应用也相当广泛。</p></blockquote>


<h3 class="relative group">编译器驱动程序 
    <div id="%E7%BC%96%E8%AF%91%E5%99%A8%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%BC%96%E8%AF%91%E5%99%A8%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>一个静态链接过程：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250408194000629.png" alt="image-20250408194000629" />
      
    </figure>
</p>


<h3 class="relative group">静态链接 
    <div id="%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>LD 静态链接器 输入.o文件 输出一个可执行文件</p>
<p>1.符号的解析</p>
<p>2.重新定位</p>


<h3 class="relative group">目标文件 
    <div id="%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>1.可重定位</p>
<p>2.可执行</p>
<p>3.共享（可以动态加载进入内存并且link）</p>


<h3 class="relative group">可重定位目标文件 
    <div id="%E5%8F%AF%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%8F%AF%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p><strong>意思就是这个文件作为一个目标文件，可以用来重定位。</strong></p>
<p>很多人开始区分不清楚.o和elf：elf就是一种格式</p>
<p>包含的内容：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250616170825010.png" alt="image-20250616170825010" />
      
    </figure>
</p>
<ul>
<li>
<p>ELF 全称是 <strong>Executable and Linkable Format（可执行与可链接格式）</strong></p>
</li>
<li>
<p>是 Linux 系统中常用的<strong>目标文件格式</strong>（Windows 上用的是 PE 格式）</p>
</li>
<li>
<p>一个 ELF 文件可以是：</p>
<ul>
<li><strong>可重定位目标文件（Relocatable Object File）</strong> → <code>.o</code> 文件</li>
<li><strong>可执行文件（Executable File）</strong> → 如通过链接生成的可执行程序</li>
<li><strong>共享库文件（Shared Object File）</strong> → <code>.so</code> 文件</li>
<li><strong>核心转储文件（Core Dump）</strong> → 程序崩溃时生成的调试文件</li>
</ul>
</li>
<li>
<p><code>.o</code> 文件是用编译器（如 <code>gcc -c</code>）从 <code>.c</code> 文件生成的</p>
</li>
<li>
<p><code>.o</code> 文件的格式就是 <strong>ELF 格式的“可重定位目标文件”</strong></p>
</li>
<li>
<p>它通常还不包含主函数（<code>main()</code>），不能直接运行，需要<strong>链接成可执行文件</strong></p>
</li>
</ul>
<p>一个典型的格式如下：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250408195710553.png" alt="image-20250408195710553" />
      
    </figure>
</p>
<p>.text:机器代码</p>
<p>.rodata:只读data</p>
<p>.data:全局 静态变量</p>
<p>.bss:未初始化或者初始化为0的全局静态(<strong>better save space</strong>(?))</p>
<p>.symtab:符号表，函数和全局变量的信息</p>
<p>​	我们用<strong>readelf</strong>工具去读取头文件的内容，并且分析一下这个内容：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250616171110203.png" alt="image-20250616171110203" />
      
    </figure>
</p>
<p>什么是<strong>Magic</strong> <strong>Number</strong>：<strong>标识了这个可重定位目标文件</strong>：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250616171305797.png" alt="image-20250616171305797" />
      
    </figure>
</p>
<p>根据上述的信息，可以得到：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250616172117252.png" alt="image-20250616172117252" />
      
    </figure>
</p>
<p>那么section中存放的：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250616172756539.png" alt="image-20250616172756539" />
      
    </figure>
</p>
<p>就如我们上面所提到的。</p>


<h3 class="relative group">符号和符号表 
    <div id="%E7%AC%A6%E5%8F%B7%E5%92%8C%E7%AC%A6%E5%8F%B7%E8%A1%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%A6%E5%8F%B7%E5%92%8C%E7%AC%A6%E5%8F%B7%E8%A1%A8" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<blockquote>
<p>*<strong>符号表</strong>是重点内容。</p></blockquote>
<p>每个<strong>可重定位模块m</strong>都有一个<strong>符号表</strong>，这个symbol table就在section中。</p>
<p>1.全局符号 我定义的<strong>非静态C函数</strong>和<strong>全局变量</strong>。</p>
<p>2.外部符号 别人定义的<strong>非静态C函数</strong>和<strong>全局变量</strong>。</p>
<p>3.<strong>局部符</strong>号 我的<strong>static函数</strong>和局部变量（.symtab不关心这些东西）,直接在<strong>stack</strong>中管理。</p>
<blockquote>
<p>所以，在C语言多文件编程中，用<strong>static保护好自己的函数和变量</strong>是好的习惯。</p>
<p>不会被别人引用（明明是我先来的！！！）</p></blockquote>
<p><strong>符号表条目</strong>：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250408202046410.png" alt="image-20250408202046410" />
      
    </figure>
</p>
<p>每个字段都被分配到目标文件的某个section</p>
<p>用 <strong>readelf</strong> 查看目标文件内容</p>
<table>
  <thead>
      <tr>
          <th>选项</th>
          <th>含义</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th><code>-h</code></th>
          <th>查看 ELF 文件头（Header）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th><code>-S</code></th>
          <th>查看段表（Section Headers）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th><code>-s</code></th>
          <th>查看符号表（Symbol Table）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th><code>-r</code></th>
          <th>查看重定位信息（Relocation Info）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th><code>-l</code></th>
          <th>查看程序头表（Program Header）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th><code>-x &lt;section&gt;</code></th>
          <th>以十六进制查看某个段的内容</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th><code>-a</code></th>
          <th>查看所有信息（等价于所有选项的合集）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<p>main.c</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sum</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>sum.c</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sum</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">$readelf</span> -s main.o
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Symbol table <span class="s1">&#39;.symtab&#39;</span> contains <span class="m">6</span> entries:
</span></span><span class="line"><span class="cl">   Num:    Value          Size Type    Bind   Vis      Ndx Name
</span></span><span class="line"><span class="cl">     0: <span class="m">0000000000000000</span>     <span class="m">0</span> NOTYPE  LOCAL  DEFAULT  UND 
</span></span><span class="line"><span class="cl">     1: <span class="m">0000000000000000</span>     <span class="m">0</span> FILE    LOCAL  DEFAULT  ABS main.c
</span></span><span class="line"><span class="cl">     2: <span class="m">0000000000000000</span>     <span class="m">0</span> SECTION LOCAL  DEFAULT    <span class="m">1</span> .text
</span></span><span class="line"><span class="cl">     3: <span class="m">0000000000000000</span>     <span class="m">8</span> OBJECT  GLOBAL DEFAULT    <span class="m">3</span> array
</span></span><span class="line"><span class="cl">     4: <span class="m">0000000000000000</span>    <span class="m">40</span> FUNC    GLOBAL DEFAULT    <span class="m">1</span> main
</span></span><span class="line"><span class="cl">     5: <span class="m">0000000000000000</span>     <span class="m">0</span> NOTYPE  GLOBAL DEFAULT  UND sum
</span></span></code></pre></div><blockquote>
<p>有点懵，务必做课后练习题进一步理解。</p></blockquote>


<h3 class="relative group">符号解析 
    <div id="%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<blockquote>
<p>链接器是怎样工作的？</p></blockquote>
<p><em>对于每个输入的文件的符号表进行扫描。</em></p>


<h4 class="relative group">多重定义的全局符号？ 
    <div id="%E5%A4%9A%E9%87%8D%E5%AE%9A%E4%B9%89%E7%9A%84%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%A4%9A%E9%87%8D%E5%AE%9A%E4%B9%89%E7%9A%84%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>全局&mdash;》强 弱</p>
<p>强符号：函数 <strong>已经初始化的全局变量</strong></p>
<p>弱符号：<strong>未初始化的全局变量</strong></p>
<p><strong>规则：</strong></p>
<p>1.强不能重名</p>
<p>2.一强多弱选强符号</p>
<p>3.多个弱符号随机选择（<strong>2,3都是比较危险的情况</strong>）</p>
<p>-fno-common:遇到多重定义的全局符号直接触发错误，比较保险。</p>
<p>是比较好理解的部分。</p>


<h4 class="relative group">与静态库的链接？ 
    <div id="%E4%B8%8E%E9%9D%99%E6%80%81%E5%BA%93%E7%9A%84%E9%93%BE%E6%8E%A5" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%8E%E9%9D%99%E6%80%81%E5%BA%93%E7%9A%84%E9%93%BE%E6%8E%A5" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>​	静态库作为存档（archieve）存放在磁盘中，可以认为是一组可重定位目标文件的集合，当我们自己的编程中引用库时就如下图所示：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250415195916810.png" alt="image-20250415195916810" />
      
    </figure>
</p>
<p>当你引用addvec时，直接复制addvec.o到可执行的文件。</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250616201136313.png" alt="image-20250616201136313" />
      
    </figure>
</p>


<h4 class="relative group">如何使用静态库解析引用？ 
    <div id="%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E5%BA%93%E8%A7%A3%E6%9E%90%E5%BC%95%E7%94%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E5%BA%93%E8%A7%A3%E6%9E%90%E5%BC%95%E7%94%A8" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>对于一行编译的命令，linker会从左到右进行扫描，维护三个集合：</p>
<p>1.E：维护可重定位目标文件的集合</p>
<p>2.U：未解析的符号的集合</p>
<p>3.D：前面输入文件的已经定义的符号的集合</p>
<p><strong>process：</strong></p>
<p>1.扫描过程中，若为一个目标文件f，直接放入E中，并且在U和D中更改元素（比如自己定义的符号就放到D，此时引用的静态库的符号就放到U）。</p>
<p>2.若f是一个archieve，那么我们将archive中的成员和U中的元素比对，如果定义了，就把这个元素放到D中去。</p>
<p>3.linker完成之后，|U| ！= 0 ，那么报错中止。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">unix&gt; gcc -static ./libvector.a main2.c
</span></span><span class="line"><span class="cl">/tmp/cc9XH6Rp.o: In <span class="k">function</span> ‘main’:
</span></span><span class="line"><span class="cl">/tmp/cc9XH6Rp.o<span class="o">(</span>.text+0x18<span class="o">)</span>: undefined reference to ‘addvec’
</span></span></code></pre></div><p>​	那么考察这样的情况，若你把静态库放到前面，那么开始就会和U中的元素比对，但是此时U中没有元素，当main.c被扫描时，此时它引用的静态库中的函数就会是<strong>undefined</strong>。</p>
<blockquote>
<p>所以我们要把<strong>库放在最后，并且要根据库之间的依赖型进行排序（拓扑排序）</strong>。</p>
<p>如果有更复杂的依赖性问题，就可以多次在命令行上<strong>重复库</strong>（可以看课后题目）。</p>
<p>如下图所示的过程：</p></blockquote>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250616201457592.png" alt="image-20250616201457592" />
      
    </figure>
</p>


<h3 class="relative group">重定位 
    <div id="%E9%87%8D%E5%AE%9A%E4%BD%8D" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<blockquote>
<p>就是更换地址。</p></blockquote>
<p>合并输入模块，为每个符号<strong>分配运行</strong>时地址。</p>
<p>1.重定位节和<strong>符号定义</strong></p>
<p>​	比如把所有的**.data<strong>节合并成一个节并且</strong>分配地址**。</p>
<p>2.重定位节中的<strong>符号引用</strong></p>
<p>​	修改符号引用，使其指向正确的运行时地址。</p>


<h4 class="relative group">重定位条目 
    <div id="%E9%87%8D%E5%AE%9A%E4%BD%8D%E6%9D%A1%E7%9B%AE" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E6%9D%A1%E7%9B%AE" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p><strong>汇编器</strong>生成目标模块时生成.rel.data .rel.text 重定位条目</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250417193235496.png" alt="image-20250417193235496" />
      
    </figure>
</p>


<h4 class="relative group">重定位符号引用 
    <div id="%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%AC%A6%E5%8F%B7%E5%BC%95%E7%94%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%AC%A6%E5%8F%B7%E5%BC%95%E7%94%A8" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>重定位算法遍历每个section和遍历每个条目：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">foreach</span> <span class="n">section</span> <span class="n">s</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="n">foreach</span> <span class="n">relocation</span> <span class="n">entry</span> <span class="n">r</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">refptr</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">r</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span> <span class="cm">/* ptr to reference to be relocated */</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/* relocate a PC-relative reference */</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//相对地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">R_386_PC32</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">refaddr</span> <span class="o">=</span> <span class="nf">ADDR</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span> <span class="cm">/* ref’s runtime address */</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="n">refptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span> <span class="p">(</span><span class="nf">ADDR</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">symbol</span><span class="p">)</span> <span class="o">+</span> <span class="o">*</span><span class="n">refptr</span> <span class="o">-</span> <span class="n">refaddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//绝对地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="cm">/* relocate an absolute reference */</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">R_386_32</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="n">refptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span> <span class="p">(</span><span class="nf">ADDR</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">symbol</span><span class="p">)</span> <span class="o">+</span> <span class="o">*</span><span class="n">refptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>对于上面的main.o 做</p>
<p>objdump -dx main.o</p>
<pre tabindex="0"><code class="language-livescript" data-lang="livescript">Disassembly of section .text:

0000000000000000 &lt;main&gt;:
   0:   f3 0f 1e fa             endbr64 
   4:   55                      push   %rbp
   5:   48 89 e5                mov    %rsp,%rbp
   8:   48 83 ec 10             sub    $0x10,%rsp
   c:   be 02 00 00 00          mov    $0x2,%esi
  11:   48 8d 05 00 00 00 00    lea    0x0(%rip),%rax        # 18 &lt;main+0x18&gt;
                        14: R_X86_64_PC32       array-0x4
  18:   48 89 c7                mov    %rax,%rdi
  1b:   e8 00 00 00 00          call   20 &lt;main+0x20&gt;
                        1c: R_X86_64_PLT32      sum-0x4
  20:   89 45 fc                mov    %eax,-0x4(%rbp)
  23:   8b 45 fc                mov    -0x4(%rbp),%eax
  26:   c9                      leave  
  27:   c3                      ret    
</code></pre><p>这是我电脑上实际运行的结果，array和sum都是<strong>重定位PC相对引用</strong></p>


<h4 class="relative group">重定位PC相对引用 
    <div id="%E9%87%8D%E5%AE%9A%E4%BD%8Dpc%E7%9B%B8%E5%AF%B9%E5%BC%95%E7%94%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%87%8D%E5%AE%9A%E4%BD%8Dpc%E7%9B%B8%E5%AF%B9%E5%BC%95%E7%94%A8" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<pre tabindex="0"><code class="language-livescript" data-lang="livescript">  1b:   e8 00 00 00 00          call   20 &lt;main+0x20&gt;
</code></pre><p>观察这一行，e8是call的操作码，后面的00 00 00 00 都是PC相对引用的占位符。</p>
<p>在重定位时，利用上述的算法，告诉我们sum在main中的偏移量，我们可以在这里调用到sum。</p>
<p>求两个地址之间的相对位置：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250616202744519.png" alt="" />
      
    </figure>
</p>


<h4 class="relative group">重定位绝对引用 
    <div id="%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%BB%9D%E5%AF%B9%E5%BC%95%E7%94%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%BB%9D%E5%AF%B9%E5%BC%95%E7%94%A8" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>在目标文件中直接计算并且更改。</p>
<p>在我们重定位之后：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objc" data-lang="objc"><span class="line"><span class="cl"><span class="mo">000000000000112</span><span class="mi">9</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1129</span><span class="o">:</span>       <span class="n">f3</span> <span class="mf">0f</span> <span class="mi">1</span><span class="n">e</span> <span class="n">fa</span>             <span class="n">endbr64</span> 
</span></span><span class="line"><span class="cl">    <span class="mi">112</span><span class="nl">d</span><span class="p">:</span>       <span class="mi">48</span> <span class="mi">83</span> <span class="n">ec</span> <span class="mi">08</span>             <span class="n">sub</span>    <span class="err">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1131</span><span class="o">:</span>       <span class="n">be</span> <span class="mo">02</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>          <span class="n">mov</span>    <span class="err">$</span><span class="mh">0x2</span><span class="p">,</span><span class="o">%</span><span class="n">esi</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1136</span><span class="o">:</span>       <span class="mi">48</span> <span class="mi">8</span><span class="n">d</span> <span class="mi">3</span><span class="n">d</span> <span class="n">d3</span> <span class="mi">2</span><span class="n">e</span> <span class="mo">00</span> <span class="mo">00</span>    <span class="n">lea</span>    <span class="mh">0x2ed3</span><span class="p">(</span><span class="o">%</span><span class="n">rip</span><span class="p">),</span><span class="o">%</span><span class="n">rdi</span>        <span class="err">#</span> <span class="mi">4010</span> <span class="o">&lt;</span><span class="n">array</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="mi">113</span><span class="nl">d</span><span class="p">:</span>       <span class="n">e8</span> <span class="mo">05</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>          <span class="n">call</span>   <span class="mi">1147</span> <span class="o">&lt;</span><span class="n">sum</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1142</span><span class="o">:</span>       <span class="mi">48</span> <span class="mi">83</span> <span class="n">c4</span> <span class="mi">08</span>             <span class="n">add</span>    <span class="err">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1146</span><span class="o">:</span>       <span class="n">c3</span>                      <span class="n">ret</span>    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mo">0000000000001147</span> <span class="o">&lt;</span><span class="n">sum</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1147</span><span class="o">:</span>       <span class="n">f3</span> <span class="mf">0f</span> <span class="mi">1</span><span class="n">e</span> <span class="n">fa</span>             <span class="n">endbr64</span> 
</span></span><span class="line"><span class="cl">    <span class="mi">114</span><span class="nl">b</span><span class="p">:</span>       <span class="n">ba</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>          <span class="n">mov</span>    <span class="err">$</span><span class="mh">0x0</span><span class="p">,</span><span class="o">%</span><span class="n">edx</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1150</span><span class="o">:</span>       <span class="n">b8</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>          <span class="n">mov</span>    <span class="err">$</span><span class="mh">0x0</span><span class="p">,</span><span class="o">%</span><span class="n">eax</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1155</span><span class="o">:</span>       <span class="n">eb</span> <span class="mi">09</span>                   <span class="n">jmp</span>    <span class="mi">1160</span> <span class="o">&lt;</span><span class="n">sum</span><span class="o">+</span><span class="mh">0x19</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1157</span><span class="o">:</span>       <span class="mi">48</span> <span class="mi">63</span> <span class="n">c8</span>                <span class="n">movslq</span> <span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
</span></span><span class="line"><span class="cl">    <span class="mi">115</span><span class="nl">a</span><span class="p">:</span>       <span class="mo">03</span> <span class="mi">14</span> <span class="mf">8f</span>                <span class="n">add</span>    <span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="o">%</span><span class="n">edx</span>
</span></span><span class="line"><span class="cl">    <span class="mi">115</span><span class="nl">d</span><span class="p">:</span>       <span class="mi">83</span> <span class="n">c0</span> <span class="mo">01</span>                <span class="n">add</span>    <span class="err">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">eax</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1160</span><span class="o">:</span>       <span class="mi">39</span> <span class="n">f0</span>                   <span class="n">cmp</span>    <span class="o">%</span><span class="n">esi</span><span class="p">,</span><span class="o">%</span><span class="n">eax</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1162</span><span class="o">:</span>       <span class="mi">7</span><span class="n">c</span> <span class="n">f3</span>                   <span class="n">jl</span>     <span class="mi">1157</span> <span class="o">&lt;</span><span class="n">sum</span><span class="o">+</span><span class="mh">0x10</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1164</span><span class="o">:</span>       <span class="mi">89</span> <span class="n">d0</span>                   <span class="n">mov</span>    <span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="o">%</span><span class="n">eax</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1166</span><span class="o">:</span>       <span class="n">c3</span>                      <span class="n">ret</span>    
</span></span></code></pre></div><p>main中113e的位置就是sum的重定位地址。</p>
<p>这里的值5就是重定位的值：当CPU执行call指令时，PC会指向下一条就是1142,为了执行这个指令，CPU把PC放进栈中，并且 PC += 5，也就是PC = 1147，此时，就会执行到sum的代码。</p>
<p>这个逻辑是和call指令配套的，linker在🔗这两个程序的时候，就会根据重定位表，把e8之后的占位符更改成要调用的函数相对于当前PC的偏移量的大小，call会先将PC压入栈中，PC += offset，接着就会执行到目标函数。</p>


<h3 class="relative group">可执行目标文件 
    <div id="%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>我们现在已经合成了这个：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250417203201689.png" alt="image-20250417203201689" />
      
    </figure>
</p>
<p>这是一个典型的格式。</p>
<p>我们查看一下上面那个a.out的program header</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objc" data-lang="objc"><span class="line"><span class="cl"><span class="n">Program</span> <span class="nl">Header</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">PHDR</span> <span class="n">off</span>    <span class="mh">0x0000000000000040</span> <span class="n">vaddr</span> <span class="mh">0x0000000000000040</span> <span class="n">paddr</span> <span class="mh">0x0000000000000040</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x00000000000002d8</span> <span class="n">memsz</span> <span class="mh">0x00000000000002d8</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">  <span class="n">INTERP</span> <span class="n">off</span>    <span class="mh">0x0000000000000318</span> <span class="n">vaddr</span> <span class="mh">0x0000000000000318</span> <span class="n">paddr</span> <span class="mh">0x0000000000000318</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x000000000000001c</span> <span class="n">memsz</span> <span class="mh">0x000000000000001c</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOAD</span> <span class="n">off</span>    <span class="mh">0x0000000000000000</span> <span class="n">vaddr</span> <span class="mh">0x0000000000000000</span> <span class="n">paddr</span> <span class="mh">0x0000000000000000</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">12</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x00000000000005f0</span> <span class="n">memsz</span> <span class="mh">0x00000000000005f0</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOAD</span> <span class="n">off</span>    <span class="mh">0x0000000000001000</span> <span class="n">vaddr</span> <span class="mh">0x0000000000001000</span> <span class="n">paddr</span> <span class="mh">0x0000000000001000</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">12</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x0000000000000175</span> <span class="n">memsz</span> <span class="mh">0x0000000000000175</span> <span class="n">flags</span> <span class="n">r</span><span class="o">-</span><span class="n">x</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOAD</span> <span class="n">off</span>    <span class="mh">0x0000000000002000</span> <span class="n">vaddr</span> <span class="mh">0x0000000000002000</span> <span class="n">paddr</span> <span class="mh">0x0000000000002000</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">12</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x00000000000000d8</span> <span class="n">memsz</span> <span class="mh">0x00000000000000d8</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOAD</span> <span class="n">off</span>    <span class="mh">0x0000000000002df0</span> <span class="n">vaddr</span> <span class="mh">0x0000000000003df0</span> <span class="n">paddr</span> <span class="mh">0x0000000000003df0</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">12</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x0000000000000228</span> <span class="n">memsz</span> <span class="mh">0x0000000000000230</span> <span class="n">flags</span> <span class="n">rw</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"> <span class="n">DYNAMIC</span> <span class="n">off</span>    <span class="mh">0x0000000000002e00</span> <span class="n">vaddr</span> <span class="mh">0x0000000000003e00</span> <span class="n">paddr</span> <span class="mh">0x0000000000003e00</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x00000000000001c0</span> <span class="n">memsz</span> <span class="mh">0x00000000000001c0</span> <span class="n">flags</span> <span class="n">rw</span><span class="o">-</span>
</span></span><span class="line"><span class="cl">    <span class="n">NOTE</span> <span class="n">off</span>    <span class="mh">0x0000000000000338</span> <span class="n">vaddr</span> <span class="mh">0x0000000000000338</span> <span class="n">paddr</span> <span class="mh">0x0000000000000338</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x0000000000000030</span> <span class="n">memsz</span> <span class="mh">0x0000000000000030</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">    <span class="n">NOTE</span> <span class="n">off</span>    <span class="mh">0x0000000000000368</span> <span class="n">vaddr</span> <span class="mh">0x0000000000000368</span> <span class="n">paddr</span> <span class="mh">0x0000000000000368</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x0000000000000044</span> <span class="n">memsz</span> <span class="mh">0x0000000000000044</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl"><span class="mh">0x6474e553</span> <span class="n">off</span>    <span class="mh">0x0000000000000338</span> <span class="n">vaddr</span> <span class="mh">0x0000000000000338</span> <span class="n">paddr</span> <span class="mh">0x0000000000000338</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x0000000000000030</span> <span class="n">memsz</span> <span class="mh">0x0000000000000030</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl"><span class="n">EH_FRAME</span> <span class="n">off</span>    <span class="mh">0x0000000000002004</span> <span class="n">vaddr</span> <span class="mh">0x0000000000002004</span> <span class="n">paddr</span> <span class="mh">0x0000000000002004</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x0000000000000034</span> <span class="n">memsz</span> <span class="mh">0x0000000000000034</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">   <span class="n">STACK</span> <span class="n">off</span>    <span class="mh">0x0000000000000000</span> <span class="n">vaddr</span> <span class="mh">0x0000000000000000</span> <span class="n">paddr</span> <span class="mh">0x0000000000000000</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x0000000000000000</span> <span class="n">memsz</span> <span class="mh">0x0000000000000000</span> <span class="n">flags</span> <span class="n">rw</span><span class="o">-</span>
</span></span><span class="line"><span class="cl">   <span class="n">RELRO</span> <span class="n">off</span>    <span class="mh">0x0000000000002df0</span> <span class="n">vaddr</span> <span class="mh">0x0000000000003df0</span> <span class="n">paddr</span> <span class="mh">0x0000000000003df0</span> <span class="n">align</span> <span class="mi">2</span><span class="o">**</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">         <span class="n">filesz</span> <span class="mh">0x0000000000000210</span> <span class="n">memsz</span> <span class="mh">0x0000000000000210</span> <span class="n">flags</span> <span class="n">r</span><span class="o">--</span>
</span></span></code></pre></div><p>后面的是执行的权限的问题，vaddr是开始的内存地址，memsz是总共的内存大小，off偏移量，我们要满足这样的条件：</p>
<p>​								<strong>vaddr mod align = off mod align</strong></p>
<p>这样程序执行的时候，可以有效率的传送到内存，我们会在虚拟内存的章节中学习到。</p>


<h3 class="relative group">加载可执行目标文件 
    <div id="%E5%8A%A0%E8%BD%BD%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%8A%A0%E8%BD%BD%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<blockquote>
<p>我们可能还会有一个关于加载器的实验，继续理解这个过程。</p></blockquote>
<p>./prog</p>
<p>​	这样我们来运行一个自己写的程序，loader把代码和数据复制到内存中，并且跳转到内存的第一条指令或者入口点，这个复制的过程就叫 <strong>加载（Load）</strong>。</p>
<p>​	每个linux程序都有一个运行时内存映像。</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/image-20250419155903953.png" alt="image-20250419155903953" />
      
    </figure>
</p>
<blockquote>
<p>我们对于加载的描述从概念上来说是正确的，但也不是完全准确，这是有意为之。
要理解加载实际是如何工作的 ，你必须理解<strong>进程 、虚拟内存和内存映射</strong>的概念，这些我们还没有加以讨论 。在后面笫8章和笫9章中遇到这些概念时 ，我们将重新回到加载的问题上，并逐渐向你揭开它的<strong>神秘面纱</strong>。</p></blockquote>


<h2 class="relative group">实验： 
    <div id="%E5%AE%9E%E9%AA%8C" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AE%9E%E9%AA%8C" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/compiler_driver.png" alt="https://xjtu-ics.github.io/assets/images/linklab/compiler_driver.png" />
      
    </figure>
</p>
<p>本实验就是模仿ld，写一个静态的linker，类似于linux的ld工具。</p>
<p>用简单的cpp就可以。</p>
<p>为什么要linker：为源代码的模块化提供可以相互引用的接口（extern）。</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/linker-workflow.png" alt="https://xjtu-ics.github.io/assets/images/linklab/linker-workflow.png" />
      
    </figure>
</p>
<p>1.符号解析：为每个外部文件的符号引用找对应的解析。</p>
<p>2.合并成一个可执行文件。</p>
<p>3.重定位，修改可执行文件代码，使其指向正确的位置。</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/relocation-workflow.png" alt="https://xjtu-ics.github.io/assets/images/linklab/relocation-workflow.png" />
      
    </figure>
</p>
<p>CPU使用PC相对引用访问地址。</p>
<p>重定位就是在合并之后，在这些空缺的位置填入地址。</p>
<p>实验框架：</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/img/framework-workflow.png" alt="https://xjtu-ics.github.io/assets/images/linklab/framework-workflow.png" />
      
    </figure>
</p>
<p>我们要实现的就是解析和重定位这两个关键过程。</p>
<p>理解关键的数据结构：</p>


<h4 class="relative group">ObjectFile 
    <div id="objectfile" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#objectfile" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>用来存储目标文件中所需的信息，其包含的成员变量及其含义如下：</p>
<ul>
<li>symbolTable ：目标文件的符号表，保存其每一个符号（见下文Symbol）</li>
<li>relocTable ：目标文件的重定位表，保存其每一个重定位条目（见下文RelocEntry）</li>
<li>sections ：目标文件的节表，保存节名string到节的映射（见下文Section）</li>
<li>sectionsByIdx ：目标文件的节表，保存节索引index到节指针Section*的映射</li>
<li>baseAddr ：目标文件在内存中的起始地址，详见test0</li>
<li>size ：目标文件的大小</li>
</ul>


<h4 class="relative group">Section 
    <div id="section" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#section" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>用来存储目标文件中的一个节，其包含的成员变量及含义如下：</p>
<ul>
<li>name ：节名称</li>
<li>type ：节类型，在本实验中略</li>
<li>flags ：节标志，在本实验中略</li>
<li>info ：节附加信息，在本实验中略</li>
<li>index ：节下标</li>
<li>addr ：节的起始地址</li>
<li>off ：节在目标文件中的偏移量</li>
<li>size ：节大小</li>
<li>align ：节在目标文件中的对齐限制</li>
</ul>
<p>关于type和flags的详细信息可参考[ELF文件的man手册中有关Shdr的部分](<a href="https://www.man7.org/linux/man-pages/man5/elf.5.html#:~:text=Section" target="_blank">https://www.man7.org/linux/man-pages/man5/elf.5.html#:~:text=Section</a> header (Shdr))。</p>


<h4 class="relative group">Symbol 
    <div id="symbol" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#symbol" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>用来存储目标文件中的一个符号，其包含的成员变量及含义如下：</p>
<ul>
<li>name ：符号名称，为string类型。</li>
<li>value ：符号值，表示符号在其所属节中的偏移量。</li>
<li>size ：符号大小，当符号未定义时则为0</li>
<li>type ：符号类型，例如符号是变量还是函数</li>
<li>bind ：符号绑定，例如符号为全局或局部的</li>
<li>visibility ：符号可见性，本实验中略</li>
<li>offset ：符号在目标文件中的偏移量</li>
<li>index ：符号相关节的节头表索引</li>
</ul>


<h4 class="relative group">RelocEntry 
    <div id="relocentry" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#relocentry" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>用来存储目标文件中的一个引用产生的重定位条目，其包含的成员变量及含义如下：</p>
<ul>
<li>sym ：指向与该重定位条目关联的符号Symbol的指针</li>
<li>name ：重定位条目关联的符号名称，类型为string</li>
<li>offset ：重定位条目在节中的偏移量</li>
<li>type ：重定位条目类型</li>
<li>addend ：常量加数，用于计算要存储到可重定位字段中的值</li>
</ul>


<h4 class="relative group">allObject 
    <div id="allobject" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#allobject" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>用来存储所有目标文件对应的<code>ObjectFile</code>数据结构。</p>


<h4 class="relative group">mergedObject 
    <div id="mergedobject" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#mergedobject" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>所有目标文件合并为一个后对应的<code>ObjectFile</code>。</p>
<p>对于 <strong>绝对重定位</strong>（如 <code>R_X86_64_64</code>）：</p>
<p>结果=符号地址+addend\text{结果} = \text{符号地址} + \text{addend}结果=符号地址+addend</p>
<p>对于 <strong>PC 相对重定位</strong>（如 <code>R_X86_64_PC32</code>）：</p>
<p>结果=符号地址+addend−当前地址\text{结果} = \text{符号地址} + \text{addend} - \text{当前地址}结果=符号地址+addend−当前地址</p>
<blockquote>
<p>​    想一想：为什么R_X86_64_32对应的addend为0，而R_X86_64_PC32不是？addend有什么实际意义？</p></blockquote>
<p>前面是绝对地址，我们是直接得到的，但是后面是PC相对寻址，也就是说call的时候，是相对于此时的PC的值的偏移量计算的，在找数组中的某个值的时候也非常有用。</p>


<h4 class="relative group">重定位的逻辑： 
    <div id="%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%9A%84%E9%80%BB%E8%BE%91" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%9A%84%E9%80%BB%E8%BE%91" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<blockquote>
<p>说到重定位就要考虑到重定位表的问题，我们要如何利用重定位表修改可执行目标文件中的占位符号（0000）。</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;relocation.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// test0和test1都只需要进行重定位即可
</span></span></span><span class="line"><span class="cl"><span class="c1">// 重定位是加载这个程序之前我要修改值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">handleRela</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ObjectFile</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">allObject</span><span class="p">,</span> <span class="n">ObjectFile</span> <span class="o">&amp;</span><span class="n">mergedObject</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isPIE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* When there is more than 1 objects,
</span></span></span><span class="line"><span class="cl"><span class="cm">     * you need to adjust the offset of each RelocEntry
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 合并之后，我们要更改偏移量,在大于1的情况下
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">allObject</span><span class="p">.</span><span class="nf">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 每次sum都要加上一整个节大小的偏移
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">uint64_t</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">object</span> <span class="p">:</span> <span class="n">allObject</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">rel</span> <span class="p">:</span> <span class="n">object</span><span class="p">.</span><span class="n">relocTable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">rel</span><span class="p">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="n">sum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">sum</span> <span class="o">+=</span> <span class="n">object</span><span class="p">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&#34;.text&#34;</span><span class="p">].</span><span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* in PIE executables, user code starts at 0xe9 by .text section */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* in non-PIE executables, user code starts at 0xe6 by .text section */</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 注意 textOff 和 textAddr 的区别：textOff 是指 .text 节在 ELF 文件中存储的位置，而 textAddr 是指 .text 节被运行时加载后在内存中所处的位置。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 这里都是mergeObject的位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint64_t</span> <span class="n">userCodeStart</span> <span class="o">=</span> <span class="n">isPIE</span> <span class="o">?</span> <span class="mh">0xe9</span> <span class="o">:</span> <span class="mh">0xe6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint64_t</span> <span class="n">textOff</span> <span class="o">=</span> <span class="n">mergedObject</span><span class="p">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&#34;.text&#34;</span><span class="p">].</span><span class="n">off</span> <span class="o">+</span> <span class="n">userCodeStart</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint64_t</span> <span class="n">textAddr</span> <span class="o">=</span> <span class="n">mergedObject</span><span class="p">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&#34;.text&#34;</span><span class="p">].</span><span class="n">addr</span> <span class="o">+</span> <span class="n">userCodeStart</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">object</span> <span class="p">:</span> <span class="n">allObject</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">rel</span> <span class="p">:</span> <span class="n">object</span><span class="p">.</span><span class="n">relocTable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// 直接转换
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kt">uint64_t</span> <span class="n">baseAddr</span> <span class="o">=</span> <span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mergedObject</span><span class="p">.</span><span class="n">baseAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// 查看重定位的类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// 相对寻址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="n">rel</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">R_X86_64_PLT32</span> <span class="o">||</span> <span class="n">rel</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">R_X86_64_PC32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 填入目标指令地址和当前PC的差值 + 补偿量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">rel</span><span class="p">.</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">-</span> <span class="p">(</span><span class="n">textAddr</span> <span class="o">+</span> <span class="n">rel</span><span class="p">.</span><span class="n">offset</span><span class="p">)</span> <span class="o">+</span> <span class="n">rel</span><span class="p">.</span><span class="n">addend</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 注意这里的地址是32位的地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">*</span><span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">int</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">baseAddr</span> <span class="o">+</span> <span class="n">textOff</span> <span class="o">+</span> <span class="n">rel</span><span class="p">.</span><span class="n">offset</span><span class="p">)</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 这是绝对地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rel</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">R_X86_64_32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">rel</span><span class="p">.</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">+</span> <span class="n">rel</span><span class="p">.</span><span class="n">addend</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">*</span><span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">int</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">baseAddr</span> <span class="o">+</span> <span class="n">textOff</span> <span class="o">+</span> <span class="n">rel</span><span class="p">.</span><span class="n">offset</span><span class="p">)</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;There is something wrong...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>

<h4 class="relative group">符号解析的逻辑： 
    <div id="%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90%E7%9A%84%E9%80%BB%E8%BE%91" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90%E7%9A%84%E9%80%BB%E8%BE%91" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>这和之前我们讨论库是怎么加载的是类似的，我们维护集合。</p>
<blockquote>
<p>看了别人的代码，为了防止有抄袭的风险，我就有部分写的比较抽象。</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;resolve.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define FOUND_ALL_DEF 0
</span></span></span><span class="line"><span class="cl"><span class="cp">#define MULTI_DEF 1
</span></span></span><span class="line"><span class="cl"><span class="cp">#define NO_DEF 2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">errSymName</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">callResolveSymbols</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ObjectFile</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">allObjects</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">resolveSymbols</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ObjectFile</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">allObjects</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="nf">callResolveSymbols</span><span class="p">(</span><span class="n">allObjects</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">MULTI_DEF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;multiple definition for symbol &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">errSymName</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">abort</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">NO_DEF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;undefined reference for symbol &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">errSymName</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">abort</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* bind each undefined reference (reloc entry) to the exact valid symbol table entry
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Throw correct errors when a reference is not bound to definition,
</span></span></span><span class="line"><span class="cl"><span class="cm"> * or there is more than one definition.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 这里我们要做三件事情1.找未定义的符号2.多重定义3.把弱符号绑定到强符号上面去
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">callResolveSymbols</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ObjectFile</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">allObjects</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// if found multiple definition, set the errSymName to problematic symbol name and return MULTIDEF;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// if no definition is found, set the errSymName to problematic symbol name and return NODEF;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 维护两个集合，strong和weak
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 前面是name，后面是对应的*symbol
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">Symbol</span> <span class="o">*&gt;</span> <span class="n">weakMap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">Symbol</span> <span class="o">*&gt;</span> <span class="n">strongMap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">object</span> <span class="p">:</span> <span class="n">allObjects</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 遍历符号表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">symbol</span> <span class="p">:</span> <span class="n">object</span><span class="p">.</span><span class="n">symbolTable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 找到了一个强符号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">SHN_UNDEF</span> <span class="o">&amp;&amp;</span> <span class="n">symbol</span><span class="p">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">SHN_COMMON</span> <span class="o">&amp;&amp;</span> <span class="n">symbol</span><span class="p">.</span><span class="n">bind</span> <span class="o">==</span> <span class="n">STB_GLOBAL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 已经存在，表明多重定义
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="n">strongMap</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">strongMap</span><span class="p">.</span><span class="nf">end</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">errSymName</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">MULTI_DEF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// 原来没有，直接绑定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">strongMap</span><span class="p">.</span><span class="nf">emplace</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">symbol</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 把所有强符号绑定好了之后，再去处理弱符号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">object</span> <span class="p">:</span> <span class="n">allObjects</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">symbol</span> <span class="p">:</span> <span class="n">object</span><span class="p">.</span><span class="n">symbolTable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">SHN_COMMON</span> <span class="o">&amp;&amp;</span> <span class="n">symbol</span><span class="p">.</span><span class="n">bind</span> <span class="o">==</span> <span class="n">STB_GLOBAL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 不存在直接绑定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="n">weakMap</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">weakMap</span><span class="p">.</span><span class="nf">end</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">weakMap</span><span class="p">.</span><span class="nf">emplace</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">symbol</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 处理弱符号和强符号相同的情况
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">weakMap</span><span class="p">.</span><span class="nf">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">weakMap</span><span class="p">.</span><span class="nf">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">strongMap</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">)</span> <span class="o">!=</span> <span class="n">strongMap</span><span class="p">.</span><span class="nf">end</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">strongMap</span><span class="p">[</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">index</span> <span class="o">=</span> <span class="n">strongMap</span><span class="p">[</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 遍历重定位符号表，哪些符号要重定位但是没有在map里，说明未定义的错误
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 重定位的symbol在最后检查的时候被绑定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">object</span> <span class="p">:</span> <span class="n">allObjects</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">rel</span> <span class="p">:</span> <span class="n">object</span><span class="p">.</span><span class="n">relocTable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">strongMap</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">rel</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">strongMap</span><span class="p">.</span><span class="nf">end</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">rel</span><span class="p">.</span><span class="n">sym</span> <span class="o">=</span> <span class="n">strongMap</span><span class="p">[</span><span class="n">rel</span><span class="p">.</span><span class="n">name</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">weakMap</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">rel</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">weakMap</span><span class="p">.</span><span class="nf">end</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">rel</span><span class="p">.</span><span class="n">sym</span> <span class="o">=</span> <span class="n">weakMap</span><span class="p">[</span><span class="n">rel</span><span class="p">.</span><span class="n">name</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">errSymName</span> <span class="o">=</span> <span class="n">rel</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">NO_DEF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">FOUND_ALL_DEF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>总之，链接是一个复杂的话题，牵扯的知识很多且杂，还有动态DLL，库打桩机制等内容，之后再做了解。</p></blockquote>

          
          
          
        </div>
        
        

          
            
            
<div class="flex author">
  
    
    
      
    
    
      
        
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="mio" src="/img/blowfish_logo_hu_2d15729eafedea4d.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      Author
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      mio
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">I&rsquo;m Just A Student&hellip;</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="nunotabashinobu066@gmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

          

          

          
          <div class="mb-10"></div>
          

        

        
        

          
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_csapp\/CSAPP:LinkerLab\/index.md"
        var oid_likes = "likes_csapp\/CSAPP:LinkerLab\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/csapp/csappcachelab/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >CSAPP:CacheLab</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-04-13T18:04:22&#43;08:00">13 April 2025</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/csapp/csappmalloclab/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >CSAPP:MallocLab</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-06-01T18:18:00&#43;08:00">1 June 2025</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/reading/"
            title="">
            
            Reading
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2025
      mio
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://Ada-Church-Closure.github.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
